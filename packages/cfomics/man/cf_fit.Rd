% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cf_fit.R
\name{cf_fit}
\alias{cf_fit}
\title{Fit a Causal Inference Model}
\usage{
cf_fit(
  formula,
  data,
  method = c("grf", "ipw", "gformula", "hdml", "hdps", "bcf", "tmle", "dowhy_gcm",
    "ganite", "drlearner", "cavae", "auto"),
  graph = NULL,
  bootstrap = FALSE,
  n_bootstrap = 100L,
  return_metadata = FALSE,
  random_state = 0L,
  config_path = NULL,
  assay_name = 1,
  feature_select = "none",
  n_features = 100,
  ...
)
}
\arguments{
\item{formula}{Formula specifying the model: \code{Y ~ T | X1 + X2 + ...}
\itemize{
  \item Y: Outcome variable (numeric)
  \item T: Treatment variable (binary: 0/1)
  \item X1, X2, ...: Covariates (numeric)
}
For SummarizedExperiment, Y can be a gene name from the assay or a
column from colData.}

\item{data}{Data source: data.frame, SummarizedExperiment, or
MultiAssayExperiment object.}

\item{method}{Character, the causal inference method to use:
\describe{
  \item{"grf"}{Generalized Random Forest (R-native, recommended for most cases)}
  \item{"ipw"}{Inverse Probability Weighting (R-native)}
  \item{"gformula"}{G-computation/parametric g-formula (R-native, no extra packages)}
  \item{"hdml"}{High-Dimensional Machine Learning/Debiased Lasso (R-native, requires glmnet)}
  \item{"hdps"}{High-Dimensional Propensity Score/IPW (R-native, requires glmnet)}
  \item{"bcf"}{Bayesian Causal Forests (R-native, requires bcf)}
  \item{"tmle"}{Targeted Maximum Likelihood Estimation (R-native, requires glmnet)}
  \item{"dowhy_gcm"}{DoWhy Graphical Causal Model (Python, requires DAG)}
  \item{"drlearner"}{Double/Debiased Machine Learning (Python)}
  \item{"ganite"}{GAN-based ITE estimation (Python/TensorFlow)}
  \item{"cavae"}{Causal Effect VAE (Python/Pyro)}
  \item{"auto"}{Automatically select best available method}
}}

\item{graph}{igraph object representing the causal DAG. Required for
"dowhy_gcm" method. Nodes should match variable names in formula.}

\item{bootstrap}{Logical, whether to compute bootstrap confidence intervals
for ATE (default FALSE). Currently only for "dowhy_gcm" method.}

\item{n_bootstrap}{Integer, number of bootstrap iterations (default 100).}

\item{return_metadata}{Logical, whether to include extended metadata in
results (default FALSE).}

\item{random_state}{Integer, random seed for reproducibility (default 0).}

\item{config_path}{Optional path to JSON configuration file for advanced
settings (e.g., dimensionality reduction, hyperparameters).}

\item{assay_name}{For SummarizedExperiment: name or index of assay to use
(default 1).}

\item{feature_select}{For SummarizedExperiment/MultiAssayExperiment:
feature selection method ("none", "variance", "pca").}

\item{n_features}{Number of features to select from assay (default 100).}

\item{...}{Additional method-specific options passed to the backend.}
}
\value{
Object of class \code{c("cf_model", "cfomics_result")} with components:
  \describe{
    \item{method}{Character string identifying the method used.}
    \item{fit}{Method-specific fitted model with \code{res} containing results.}
    \item{meta}{Metadata including formula, dimensions, and software versions.}
  }
  See \code{\link{cfomics_result}} for the full structure specification.
}
\description{
Fits a causal inference model using various backends with a unified API.
Supports data.frame, SummarizedExperiment, and MultiAssayExperiment objects.
}
\details{
\strong{Estimand:}

All methods estimate the \strong{Average Treatment Effect (ATE)}:
\deqn{ATE = E[Y(1) - Y(0)]}

where \eqn{Y(1)} and \eqn{Y(0)} are potential outcomes under treatment and
control, respectively. Some methods (grf, drlearner, ganite, cavae) also
estimate \strong{Individual Treatment Effects (ITE)}:
\deqn{ITE_i = Y_i(1) - Y_i(0)}

\strong{Causal Assumptions:}

Valid causal inference requires:
\enumerate{
  \item \strong{SUTVA}: No interference between units
  \item \strong{Ignorability}: \eqn{(Y(0), Y(1)) \perp T | X} (no unmeasured confounding)
  \item \strong{Positivity}: \eqn{0 < P(T=1|X) < 1} for all X
}

Use \code{\link{cf_balance_check}} and \code{\link{cf_overlap_check}} to
assess these assumptions before analysis.

\strong{Method Selection Guide:}
\itemize{
  \item \strong{grf}: Best for heterogeneous effects, robust, R-native
  \item \strong{ipw}: Classical approach, easy to interpret, requires correct PS model
  \item \strong{gformula}: Outcome modeling, straightforward implementation
  \item \strong{dowhy_gcm}: DAG-based, explicit causal assumptions
  \item \strong{drlearner}: Double robustness, requires Python
  \item \strong{ganite}: Deep learning ITE, requires TensorFlow
  \item \strong{cavae}: Handles latent confounding, requires Pyro
}
}
\examples{
# Basic example with G-formula (no external packages required)
set.seed(123)
n <- 100
demo_data <- data.frame(
  X1 = rnorm(n),
  X2 = rnorm(n),
  T = rbinom(n, 1, 0.5)
)
demo_data$Y <- 2 * demo_data$T + 0.5 * demo_data$X1 + rnorm(n)

# Fit model using G-formula
fit <- cf_fit(Y ~ T | X1 + X2, data = demo_data, method = "gformula")

# Get average treatment effect
ate <- predict(fit, type = "ate")
print(ate)

# Get individual treatment effects
ite <- predict(fit, type = "ite")
head(ite)

# Model summary
summary(fit)

\donttest{
# Using GRF (requires 'grf' package)
if (requireNamespace("grf", quietly = TRUE)) {
  fit_grf <- cf_fit(Y ~ T | X1 + X2, data = demo_data, method = "grf")
  predict(fit_grf, type = "ate")
}
}

\dontrun{
# Using DoWhy-GCM (requires Python and dowhy package)
library(igraph)
g <- graph_from_edgelist(rbind(
  c("X1", "T"), c("T", "Y"), c("X2", "Y")
))
fit_dowhy <- cf_fit(Y ~ T | X1 + X2, data = demo_data,
                    method = "dowhy_gcm", graph = g)

# With SummarizedExperiment
library(SummarizedExperiment)
fit_se <- cf_fit(Gene1 ~ treatment | age, data = se, method = "grf")
}
}
\seealso{
\code{\link{cfomics_result}} for result object structure,
  \code{\link{cf_balance_check}} and \code{\link{cf_overlap_check}} for assumption checks,
  \code{\link{cf_check_env}} for environment diagnostics
}
